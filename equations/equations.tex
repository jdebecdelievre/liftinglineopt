\documentclass[letterpaper,12pt]{article}
\usepackage{tabularx} % extra features for tabular environment
\usepackage{amsmath}  % improve math presentation
\usepackage{graphicx} % takes care of graphic including machinery
\graphicspath{ {images/} }
\usepackage{float}
\usepackage[margin=1in,letterpaper]{geometry} % decreases margins
\usepackage{cite} % takes care of citations
\usepackage[final]{hyperref} % adds hyper links inside the generated pdf file
\hypersetup{
	colorlinks=true,       % false: boxed links; true: colored links
	linkcolor=blue,        % color of internal links
	citecolor=blue,        % color of links to bibliography
	filecolor=magenta,     % color of file links
	urlcolor=blue         
}

\usepackage{ar}
\usepackage{siunitx}
\usepackage{longtable}
\setlength\LTleft{0pt} 
% \def\AR{\text{\itshape\clipbox{0pt 0pt .32em 0pt}\AE\kern-.30emR}}


\begin{document}

\title{Glider Optimization with Lifting Line Theory and Airfoil Wind Tunnel Data}
\author{Jean de Becdelievre}
\date{\today}
\maketitle

\section{Nomenclature}

{\renewcommand\arraystretch{1.0}
\noindent\begin{longtable}{@{}l @{\quad : \quad} l@{}}
$W$  & glider weight \\
$L, C_L$ & lift, lift coefficient \\
$D,Di,D_0, C_D,C_{Di},C_{D_0}$& drag, induced drag, friction, and respective coefficients \\
$b$ & span \\
$S$ & wing area \\
$\AR$ & wing aspect ratio \\
$y$ & spanwise coordinate, ranging from $-b/2$ to $b/2$ \\
$\theta$ & remapped spanwise coordinate ranging from $0$ to $pi$ \\
$N_{theta}$ & Number of spanwise sections \\
$\Gamma(y) \text{ or } \Gamma(\theta)$ & spanwise strength of vortex sheet\\
$A_n$ & nth coefficient of the Fourrier expansion of $\Gamma$ \\
$N_{A}$ & Number of Fourrier coefficients considered for $\Gamma$ \\
$S$ & matrix of size $N_{\theta}, N_A$ such that: $ \forall k,n \quad S_{k,n} = \sin(n\theta_k)$ \\
$S'$ & matrix of size $N_{\theta}, N_A$ such that: $ \forall k,n \quad {S'}_{k,n} = n\sin(n\theta_k)/\sin(\theta_k)$ \\
$A$ & vector of size $N_A$ containing all the $A_n$ \\
$\alpha(y) \text{ or } \alpha(\theta)$ & spanwise angle of attack distribution\\
$\alpha_i(y) \text{ or } \alpha_i(\theta)$ & spanwise lift-induced angle of attack distribution\\
$c(y) \text{ or } c(\theta)$ & spanwise chord distribution\\
$c_l(y) \text{ or } c_l(\theta)$ & spanwise lift distribution\\
$c_d(y) \text{ or } c_d(\theta)$ & spanwise drag distribution\\
$V$ & airspeed \\
$CL_{2D} \text{ and } CD0_{2D}$ & fit of the 2D airfoil data \\
$Re$ & Reynolds number \\
$y_k, \theta_k, \alpha_k, \alpha_{i_k}, c_k, c_{l_k}$ &  $y, \theta, \alpha, \alpha_i, c, c_{l}$ at the kth section of the span\\
\end{longtable}}


\section{Optimization Problem}

This code aims at optimizing the wing shape and airspeed of a glider of a given weight W and fixed airfoil section.
2D wind tunnel data of the airfoil is available: the functions
$C_{L2D}(\alpha, Re)$ and 
$C_{D02D}(\alpha, Re)$ are provided.

The optimization problem reads:

\begin{align*}
	& \underset{V, b, c, \alpha, A}{\text{minimize}}
	& & \left( C_L / (C_{D_i} + C_{D_0})\right)^{-1} \nonumber \\
	& \text{subject to} 
	& C_L &= \frac{W}{1/2 \rho V^2 S} \\
	& & c_l(y) &= CL_{2D} \left( \alpha(\theta) + \alpha_i(y), Re(y)\right) \\
	& & c_{d_0} &= CD0_{2D}(\alpha - \alpha_i, Re(y)) \\
	& & C_L &= \frac 1 S \int_{-b/2}^{b/2} c(y') c_l(y') dy'\\
	& & C_{D_0} &= \frac 1 S \int_{-b/2}^{b/2} c(y') c_{d_0}(y') dy'\\
	& & C_{D_i} & = \frac{C_L}{\pi \AR \epsilon} \\
	& & \AR &= \frac{b^2}{S} \\
	& & \epsilon &= \left(\sum_{n=1}^{N_A} n \left(\frac{A_n}{A_1}\right)^2 \right)^{-1} \\
	& & \alpha_i(y) &= -\frac 1 {4b} \sum_{n=1}^{N_A} n A_n\frac{\sin(n\theta)}{\sin(\theta)} \\
	& \forall \theta \in [0, \pi] & \sum_{n=1}^{N_A} A_n \sin(\theta) &= \frac{1}{c(\theta)} CL_{2D} \left( \alpha(\theta) + \alpha_i(\theta), Re(\theta)\right) \\
\end{align*}

where $\theta$ is another span parametrization such that:
$$\forall \theta \in [0,\pi], \forall y \in [\frac {-b} 2, \frac b 2], \quad y = \frac b 2 \cos\theta$$

We discretize the span into $N_{theta}$ spanwise sections, and perform several simplifications detailed in the rest of this document.
The final optimization problem is:

\begin{align*}
	& \underset{V, b, c, \alpha, A}{\text{minimize}}
	& & \frac{V^2 \pi}{8}\sum_{n=1}^{N_A} n A_{n}^2 +
	  V^2 b  \sum_{k=1}^{N_{\theta}} w_{\theta}^{(k)} c_k CD0_{2D}\left( 
		\alpha_k +\alpha_{i_k}, Re(c_k, v_k)
		\right) \\
	& \text{subject to}
	&  \sum_{n=1}^{N_{A}} S_{k,n} A_n &=  c_kCL_{2D} \left( \alpha_k - \frac {1}{4b} 
		\sum_{n=1}^{N_{A}}S'_{k,n}A_n , Re(c_k, v_k)\right) \quad \text{for } k \in 1,\dots, N_{\theta} \\
	& &  A_1 &= \frac{8W}{\rho V^2 b \pi}\\
\end{align*}

\section{Lifting Line Theory}

From Kutta-Joukovsky theorem:
%
$$\Gamma(y) = \frac{l(y)}{\rho V} = \frac{1/2 \rho V^2 c(y) c_l(y)}{\rho V} =  \frac{1}{2} V c(y) c_l(y)$$

The spanwise circulation is defined on a compact $[-b/2, b/2]$, which we remap to $[0, \pi]$ and write a Fourrier series expansion:
$$y = \frac{b}{2}\cos(\theta)$$
%
$$\Gamma(\theta) = \frac{1}{2} V\sum_{n=1}^{+\infty} A_n \sin(n\theta) \text{,      } c_l(\theta) = \frac 1 {c(y)} \sum_{n=1}^{+\infty} A_n \sin(n\theta)$$

Using Biot and Savart law, the induced angle of attack on at each spanwise coordinate can be written as:
%
% \begin{equation*}
	\begin{align*}
		\alpha_i(y) &= \frac{-1}{4\pi V}\int_{-b/2}^{b/2} \frac{\frac{d\Gamma(t)}{dt}}{y-t} dt \\ 
		\alpha_i(\theta) &= \frac{-1}{4\pi V} \int_{\pi}^{0} \frac{\left( \frac{d\Gamma(\Theta)}{d\Theta} \frac{d\Theta}{dt}\right)}{b/2\cos(\theta)-b/2\cos(\Theta)}\frac{dt}{d\Theta} d\Theta	 \\
				 &= -\frac{-1}{2b\pi V} \int_{0}^{\pi} \frac{\frac{d\Gamma(\Theta)}{d\Theta}}{\cos(\theta)-\cos(\Theta)} d\Theta	
	\end{align*}
% \end{equation*}

$$\frac{d\Gamma(\Theta)}{d\Theta} = \frac{d}{d\Theta}\frac12 V\sum_{n=1}^{+\infty} A_n \sin(n\Theta)  = \frac{1}{2} V\sum_{n=1}^{+\infty} n A_n \cos(n\Theta) $$

\begin{align*}
	\alpha_i(\theta) &= -\frac{-1}{2b\pi }  \int_{0}^{\pi} \frac{ \frac{1}{2} V\sum_{n=1}^{+\infty} n A_n \cos(n\Theta) }{\cos(\theta)-\cos(\Theta)} d\Theta	\\
				&= -\frac{-1}{4b\pi }  \sum_{n=1}^{+\infty} n A_n \int_{0}^{\pi} \frac{ \cos(n\Theta) }{\cos(\theta)-\cos(\Theta)} d\Theta	\\
\end{align*}

Directly plugging in the solution of the Glauert integral:
$$ \alpha_i(\theta) = \frac {-1}{4b}  \sum_{n=1}^{+\infty} n A_n \frac{ \sin(n\theta) }{\sin(\theta)} 	$$

The general equation that needs to be solved to find the $A_{1:+\infty}$ is:
%
\begin{align*}
	c_l(\theta) &= CL_{2D} \left( \alpha(\theta) + \alpha_i(\theta), Re(\theta)\right) \\
	\sum_{n=1}^{+\infty} A_n \sin(n\theta) &= c(\theta) CL_{2D} \left( \alpha(\theta) - \frac {1}{4b}  \sum_{n=1}^{+\infty} n A_n \frac{ \sin(n\theta) }{\sin(\theta)} , Re(\theta)\right) \\
\end{align*}
%
If we only compute $A_{n}$ for $n \in [0, N_A]$, we can choose a discrete set of $\theta_k$ for $k \in [0, N_{\theta}]$:

\begin{equation}
	SA = c(\theta) CL_{2D} \left( \alpha(\theta) - \frac {1}{4b} S' A , Re(\theta)\right) 
\end{equation}

with:
\begin{itemize}
	\item[] $S$ a matrix of size $N_{\theta}, N_A$ such that: $ \forall m,n \quad S_{m,n} = \sin(n\theta_m)$ 
	\item[] $S'$ a matrix of size $N_{\theta}, N_A$ such that: $ \forall m,n \quad {S'}_{m,n} = n\sin(n\theta_m)/\sin(\theta_m)$ 
	\item[] $A$ a vector of size $N_A$ containing all the $A_n$
\end{itemize}


\section{L over D}

\begin{equation*}
	\frac L D = \frac{C_L}{C_D} = \frac {C_L} {C_{Di} + C_{D0}} 
\end{equation*}

Let us start with $C_L$:

\begin{align}
	C_L &= \frac 1 S \int_{b/2}^{b/2} c(y) c_l(y) dy  \nonumber \\
		&= \frac b {2S} \int_{0}^{\pi} \sum_{n=1}^{+N_A} A_n \sin(n\theta) \sin(\theta)d\theta \nonumber \\
		&= \frac b {2S}  \sum_{n=1}^{+N_A} A_n \int_{0}^{\pi} \sin(n\theta) \sin(\theta)d\theta \nonumber \\
\end{align}
Since the Fourrier basis is orthogonal, we have for any $k, n$:
\begin{equation*}
	\int_0^{\pi} \sin(n\theta)\sin(k\theta)d\theta = 
	\begin{cases} 
		0 & k \neq n \\
		\frac{\pi}{2} & k = n
	 \end{cases}
\end{equation*}
Therefore:
\begin{equation}
	\label{eq:cl}
	C_L = \frac{b \pi A_1}{4S}
\end{equation}



\noindent Now, to get $C_{Di}$, we look at it's spanwise distribution $c_{d_i}$:
\begin{align*}
	c_{d_i} (\theta) &= - c_l (\theta) \alpha_i (\theta) \\
					&=  \frac{1}{4bc(\theta)}\sum_{n_a=0}^{+\infty} n_a A_{n_a} \frac{ \sin(n_a\theta) }{\sin(\theta)} \sum_{n_b=0}^{+\infty} A_{n_b} \sin(n_b\theta) \\
\end{align*}
Integrating to get $C_{Di}$:
\begin{align}
	C_{Di} &= \frac b {2S} \int_{0}^{\pi} c_{d_i}(\theta) c(\theta) d\theta \nonumber\\
	C_{Di} &= \frac b {2S} \int_{0}^{\pi} \frac{1}{4b}
		\sum_{n_a=0}^{N_A} n_a A_{n_a} \frac{ \sin(n_a\theta) }{\sin(\theta)} 
		\sum_{n_b=0}^{N_A} A_{n_b} \sin(n_b\theta) \sin(\theta) 
		d\theta  \nonumber \\ 
	C_{Di} &= \frac 1 {8S} \int_{0}^{\pi} \sum_{n_a=0}^{N_A} \sum_{n_b=0}^{N_A} n_a A_{n_a}A_{n_b} \sin(n_a\theta) \sin(n_b\theta) d\theta
\end{align}
Using again that the Fourrier basis functions are orthogonal, we obtain:
%
\begin{equation}
	\label{eq:cdi}
	C_{Di} = \frac {\pi}{16S} \sum_{n=1}^{N_A} n A_{n}^2
\end{equation}
%
Finally, $C_{D_0}$ is also obtained by integration:
%
\begin{align*}
	c_{d_0}(\theta) &= CD0_{2D}\left( \alpha(\theta) + \alpha_i(\theta), Re(\theta)\right) \\
	C_{D_0}(\theta) &= \frac b {2S} \int_{0}^{\pi} c(\theta) CD0_{2D}\left( \alpha(\theta) + \alpha_i(\theta), Re(\theta)\right) \sin(\theta) d\theta \\
	C_{D_0}(\theta) &= \frac b {2S} \int_{0}^{\pi} c(\theta) CD0_{2D}\left( \alpha(\theta) - \frac {1}{4b}  \sum_{n=1}^{N_A} n A_n \frac{ \sin(n\theta) }{\sin(\theta)} , Re(\theta)\right) \sin(\theta) d\theta
\end{align*}

If $CD0_{2D}$ has an analytic expression, this can be simplified further.
In the our case however, it is a general function fitted from wind tunnel data, 
therefore the integration is performed numerically with Clenshaw–Curtis quadrature. 

Calling $w_{\theta}^{(k)}$ and $\theta_k$ respectively the weights and the points of this quadrature, we get:
\begin{equation}
	\label{eq:cd0}
	C_{D_0}(\theta) = \frac b {2S} \sum_{k=1}^{N_{\theta}} w_{\theta}^{(k)} c(\theta_k) CD0_{2D}\left( \alpha(\theta_k) - \frac {1}{4b} \sum_{n=1}^{N_A} n A_n \frac{ \sin(n\theta_k) }{\sin(\theta_k)} , Re(\theta_k)\right)
\end{equation}

Finally:

\begin{align}
	\label{eq:ld}
	\frac L D &= \frac {C_L} 
	{C_{Di} + C_{D0}} \nonumber \\
	\frac L D &= \frac{\frac{b \pi A_1}{4S}}{
		\frac {\pi}{16S} \sum_{n=1}^{+\infty} n A_{n}^2 + 
		\frac b {2S} \sum_{k=1}^{N_{\theta}} w_{\theta}^{(k)} c(\theta_k) CD0_{2D}\left( \alpha(\theta_k) - \frac {1}{4b} \sum_{n=1}^{+\infty} n A_n \frac{ \sin(n\theta_k) }{\sin(\theta_k)} , Re(\theta_k)\right)
	} \nonumber \\
	\frac L D &= \left(	\frac {1}{4bA_1} \sum_{n=1}^{+\infty} n A_{n}^2 + 
		\frac {2} {\pi A_1} \sum_{k=1}^{N_{\theta}} w_{\theta}^{(k)} c(\theta_k) CD0_{2D}\left( \alpha(\theta_k) - \frac {1}{4b} \sum_{n=1}^{+\infty} n A_n \frac{ \sin(n\theta_k) }{\sin(\theta_k)} , Re(\theta_k)\right) 
	\right)^{-1} 
\end{align}


\section{Optimization Problem}

We start with:
\begin{align*}
	& \underset{V, b, c, \alpha, A}{\text{minimize}}
	& & \left( C_L / (C_{D_i} + C_{D_0})\right)^{-1} \nonumber \\
	& \text{subject to} 
	& C_L &= \frac{W}{1/2 \rho V^@ S} \\
	& & c_l(y) &= CL_{2D} \left( \alpha(\theta) + \alpha_i(y), Re(y)\right) \\
	& & c_{d_0} &= CD0_{2D}(\alpha - \alpha_i, Re(y)) \\
	& & C_L &= \frac 1 S \int_{-b/2}^{b/2} c(y') c_l(y') dy'\\
	& & C_{D_0} &= \frac 1 S \int_{-b/2}^{b/2} c(y') c_{d_0}(y') dy'\\
	& & C_{D_i} & = \frac{C_L}{\pi \AR \epsilon} \\
	& & \AR &= \frac{b^2}{S} \\
	& & \epsilon &= \left(\sum_{n=1}^{N_A} n \left(\frac{A_n}{A_1}\right)^2 \right)^{-1} \\
	& & \alpha_i(y) &= -\frac 1 {4b} \sum_{n=1}^{N_A} n A_n\frac{\sin(n\theta)}{\sin(\theta)} \\
	& \forall \theta \in [0, \pi] & \sum_{n=1}^{N_A} A_n \sin(\theta) &= \frac{1}{c(\theta)} CL_{2D} \left( \alpha(\theta) + \alpha_i(\theta), Re(\theta)\right) \\
\end{align*}

Discretizing, and using equations \ref{eq:cl}, \ref{eq:cdi}, \ref{eq:cd0}, \ref{eq:ld}, we get:


\begin{align}
	& \underset{V, b, c, \alpha, A}{\text{minimize}}
	& & \frac {1}{4bA_1} \sum_{n=1}^{N_A} n A_{n}^2 + \nonumber \\
	&&& \frac 2 {\pi A_1} \sum_{k=1}^{N_{\theta}} w_{\theta}^{(k)} c_k CD0_{2D}\left( 
		\alpha_k - 
		\frac {1}{4b} \sum_{n=1}^{N_A} n A_n \frac{ \sin(n\theta_k) }{\sin(\theta_k)} , Re(\theta_k)
		\right) \label{obj1} \\
	& \text{subject to}
	& & SA =  CL_{2D} \left( \alpha_k - \frac {1}{4b} S' A_n , Re(\theta_k)\right)  \label{llcon1}\\
	& &  & A_1 = \frac{2W}{\rho V^2 b \pi} \label{wcon1}
\end{align}

Using \ref{wcon1} to simplify \ref{obj1} further, we obtain:

\begin{align}
	& \underset{V, b, c, \alpha, A}{\text{minimize}}
	& & \frac{V^2 \pi}{8}\sum_{n=1}^{N_A} n A_{n}^2 + \nonumber \\
	&&&  V^2 b  \sum_{k=1}^{N_{\theta}} w_{\theta}^{(k)} c_k CD0_{2D}\left( 
		\alpha_k - 
		\frac {1}{4b} \sum_{n=1}^{N_A} n A_n \frac{ \sin(n\theta_k) }{\sin(\theta_k)} , Re(\theta_k)
		\right) \label{obj2} \\
	& \text{subject to}
	& & SA =  CL_{2D} \left( \alpha_k - \frac {1}{4b} S' A_n , Re(\theta_k)\right)  \label{llcon2}\\
	& &  & A_1 = \frac{8W}{\rho V^2 b \pi} \label{wcon2}
\end{align}

because:

\begin{align*}
	\frac{1}{4bA_1} &= \frac{\rho V^2 \pi}{8W} \\
	\frac{\pi}{2A_1} &= \frac{\rho V^2 b}{ W} 
\end{align*}

% \begin{align}
% 	& \underset{V, b, c, \alpha, A}{\text{minimize}}
% 	& & \frac{V^2 \pi}{8}\sum_{n=1}^{N_A} n A_{n}^2 +
% 	  V^2 b  \sum_{k=1}^{N_{\theta}} w_{\theta}^{(k)} c_k CD0_{2D}\left( 
% 		\alpha_k - \frac {1}{4b} S' A_n, Re(\theta_k)
% 		\right) \label{obj1} \\
% 	& \text{subject to}
% 	& & SA =  CL_{2D} \left( \alpha_k - \frac {1}{4b} S' A_n , Re(\theta_k)\right)  \label{llcon1}\\
% 	& &  & A_1 = \frac{8W}{\rho V^2 b \pi} \label{wcon1}
% \end{align}


% \begin{align}
% 	& \underset{V, b, c, \alpha, \alpha_i A}{\text{minimize}}
% 	& & \frac{V^2 \pi}{8}\sum_{n=1}^{N_A} n A_{n}^2 +
% 	  V^2 b  \sum_{k=1}^{N_{\theta}} w_{\theta}^{(k)} c_k CD0_{2D}\left( 
% 		\alpha_k +\alpha_{i_k}, Re(\theta_k)
% 		\right) \label{obj2} \\
% 	& \text{subject to}
% 	& & SA =  CL_{2D} \left( \alpha_k + \alpha_{i_k} , Re(\theta_k)\right)  \label{llcon1}\\
% 	& &  & A_1 \geq \frac{8W}{\rho V^2 b \pi} \label{wcon2}\\
% 	& &  & \alpha_{i_k}\geq - \frac {1}{4b} S' A_n \label{aindcon2}
% \end{align}

% \begin{align*}
% 	& \underset{V, b, c, \alpha, A}{\text{minimize}}
% 	& & \frac{V^2 \pi}{8}\sum_{n=1}^{N_A} n A_{n}^2 +
% 	  V^2 b  \sum_{k=1}^{N_{\theta}} w_{\theta}^{(k)} c_k CD0_{2D}\left( 
% 		\alpha_k +\alpha_{i_k}, Re(c_k, v_k)
% 		\right) \\
% 	& \text{subject to}
% 	&  \sum_{n=1}^{N_{A}} S_{k,n} A_n &=  c_kCL_{2D} \left( \alpha_k - \frac {1}{4b} 
% 		\sum_{n=1}^{N_{A}}S'_{k,n}A_n , Re(c_k, v_k)\right) \quad \text{for } k \in 1,\dots, N_{\theta} \\
% 	& &  A_1 &= \frac{8W}{\rho V^2 b \pi}\\
% \end{align*}

Finally, we incorporate \ref{wcon2} into the objective function and the constraint.

\begin{align*}
	& \underset{V, b, c, \alpha, A}{\text{minimize}} &
	\frac{W}{\rho b} + \frac{V^2 \pi}{8}\sum_{n=2}^{N_A} n A_{n}^2 &+
	  V^2 b  \sum_{k=1}^{N_{\theta}} w_{\theta}^{(k)} c_k CD0_{2D}
	  \left( \alpha_k
	  - \frac {1}{4b} S'_{k,i}\frac{8W}{\rho V^2 b \pi}
	  - \frac {1}{4b}\sum_{n=1}^{N_{A}}S'_{k,n}A_n , Re(c_k, v_k)
	  \right)\\
	& \text{subject to} &
 	S_{k, 1} \frac{8W}{\rho V^2 b \pi} &+ \sum_{n=2}^{N_{A}} S_{k,n} A_n = \\
	& & c_kCL_{2D} & \left( \alpha_k
		 - \frac {1}{4b} S'_{k,i}\frac{8W}{\rho V^2 b \pi}
		 - \frac {1}{4b}\sum_{n=1}^{N_{A}}S'_{k,n}A_n , Re(c_k, v_k)\right)
		 \quad \text{for } k \in 1,\dots, N_{\theta}
\end{align*}

\end{document}
\textsl{}